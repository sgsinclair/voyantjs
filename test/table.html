<html>
<body>
<div id="table1"></div>
<div id="table2"></div>
<script type="module">
	import * as Table from '../src/table.js';
	import * as Test from './test.js'
	
	let table;
	
	// empty table
	table = Table.create();
	Test.equals(table.rows(),0);
	Test.equals(table.columns(),0);
	Test.error(() => table.cell(0,0), "The requested row does not exist: 0");

	// table with a single value
	table = Table.create(1);
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),1);
	Test.equals(table.cell(0,0), 1);
	
	// table with a multiple values
	table = Table.create(1,2);
	Test.equals(table.rows(),2);
	Test.equals(table.columns(),1);
	Test.equals(table.cell(0,0), 1);

	// table with a multiple values
	table = Table.create(1,2,true);
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),1);
	Test.equals(table.cell(2,0), true);
	
	// table with config and multiple values
	table = Table.create({headers: ["val"]}, 1 ,2, true);
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),1);
	Test.equals(table.cell(2,0), true);
	
	// table with config and multiple values
	table = Table.create({headers: ["ind","val"]}, [0,1] , [1,2], [2,true]);
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),2);
	Test.equals(table.cell(2,1), true);
	
	// table with a single array
	table = Table.create([1]);
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),1);
	Test.equals(table.cell(0,0), 1);
	
	// table with a single array with multiple values
	table = Table.create([1,2]);
	Test.equals(table.rows(),2);
	Test.equals(table.columns(),1);
	Test.equals(table.cell(0,0), 1);
	
	// table with double array
	table = Table.create([[1,2],[3,4]]);
	Test.equals(table.rows(),2);
	Test.equals(table.columns(),2);
	Test.equals(table.cell(1,1), 4);

	// table with single array
	table = Table.create(["one","two","two","three","three","three"]);
	Test.equals(table.rows(),6);
	Test.equals(table.columns(),1);
	Test.equals(table.cell(2,0), "two");


	let words = ["one","two","two","three","three","three"];
	
	// table with single array to be counted
	table = Table.create(words, {count: true});
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),3);
	Test.equals(table.cell(0,"two"), 2);
	table.rowSort(); // unchanged
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),3);
	Test.equals(table.cell(0,"two"), 2);
	table.rowSort(1); // unchanged
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),3);
	Test.equals(table.cell(0,"two"), 2);
	table.columnSort(); // sort by alphabetic order
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),3);
	Test.equals(table.cell(0,0), 1);
	Test.equals(table.cell(0,1), 3);
	Test.equals(table.cell(0,2), 2);
	table.setColumn("four", 4, true);
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),4);
	Test.equals(table.cell(0,3), 4);
	Test.equals(table.cell(0,"four"), 4);
	table.setColumn("five", [5], true);
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),5);
	Test.equals(table.cell(0,4), 5);
	Test.equals(table.cell(0,"five"), 5);
	Test.equals(table.rowRollingMean(0,1)[4], 4.5);
	table.rowRollingMean(0,1,true);
	Test.equals(table.rows(),1);
	Test.equals(table.columns(),5);
	Test.equals(table.cell(0,4), 4.5);
	Test.equals(table.cell(0,"five"), 4.5);

	// table with single array to be counted
	table = Table.create(words, {count: "vertical", rowKeyColumn: 0, headers: ["item","count"]});
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),2);
	Test.equals(table.cell(0,0), "one");
	Test.equals(table.cell(0,1), 1);
	Test.equals(table.cell("one",1), 1);
	Test.equals(table.cell("one","count"), 1);
	table.rowSort();
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),2);
	Test.equals(table.cell(2,0), "two"); // from row 1 to row 2
	table.rowSort("count", {reverse: true});
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),2);
	Test.equals(table.cell(2,0), "one"); // from row 1 to row 2
	table.rowSort((a,b) => a[0].localeCompare(b[0]));
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),2);
	Test.equals(table.cell(2,0), "two"); // sorted alphabetically at end
	table.rowSort((a,b) => b.item.localeCompare(a.item), {asObject: true});
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),2);
	Test.equals(table.cell(2,0), "one"); // reverse sorted alphabetically at end

	table.columnSort(); // sort by column name
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),2);
	Test.equals(table.header(0), "count");
	Test.equals(table.cell(2,0), 1); // reverse sorted alphabetically at end
	Test.equals(table.toCsv(), "count,item\n2,two\n3,three\n1,one");
	Test.equals(table.toTsv(), "count	item\n2	two\n3	three\n1	one");
	Test.equals(table.toHtml(), "<table class='voyantTable'><tr><th>count</th>,<th>item</th></tr><tr><td>2</td>,<td>two</td></tr>,<tr><td>3</td>,<td>three</td></tr>,<tr><td>1</td>,<td>one</td></tr></table>");
	table.html("#table1");
	table.html(document.getElementById("table2"))
	Test.equals(document.querySelectorAll("table").length, 2)
	// let newTable = Table.create(table.toCsv());
	// console.warn(newTable);


	// table adding rows with chaining
	table = Table.create({headers: ["item","count"]});
	table.addRow("one", 1).addRow(["two", 2]);
	table.setCell(2,0,"three").setCell(2,1,3);
	Test.equals(table.rows(),3);
	Test.equals(table.columns(),2);
	Test.equals(table.cell(0,0), "one");
	Test.equals(table.cell(0,1), 1);
	Test.equals(table.cell(1,"item"), "two");
	Test.equals(table.cell("three", "count"), 3);
	let rows = table.rows(true);
	Test.equals(rows.length, 3);
	Test.equals(rows[0][0], "one");
	Test.equals(rows[2][1], 3);
	rows = table.rows(2); // single
	Test.equals(rows.length, 1);
	Test.equals(rows[0][0], "three");
	Test.equals(rows[0][1], 3);
	rows = table.rows(1,2); // varargs
	Test.equals(rows.length, 2);
	Test.equals(rows[0][0], "two");
	Test.equals(rows[0][1], 2);
	rows = table.rows([0,2]); // array
	Test.equals(rows.length, 2);
	Test.equals(rows[0][0], "one");
	Test.equals(rows[0][1], 1);
	rows = table.rows([0,2], {zip: true}); // array
	Test.equals(rows.length, 2);
	Test.equals(rows[0][0], "one");
	Test.equals(rows[0][1], "three");
	Test.equals(rows[1][0], 1);
	Test.equals(rows[1][1], 3);
	
	

	console.info("all done.")
	
</script>
</body>
</html>